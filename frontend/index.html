<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sanu Sharma - Aisha AI</title>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto,"Helvetica Neue", Arial; background: #0f172a; color: #e6eef8; min-height:100vh; display:flex; justify-content:center; align-items:center; transition:background 0.5s ease;}
    body.light {background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);}
    .chat-container {width:100%; max-width:800px; height:95vh; background: #0b1220; border-radius: 10px; display:flex; flex-direction:column; overflow:hidden; box-shadow: 0 10px 30px rgba(2, 6, 23, 0.6); transition: background 0.5s ease;}
    body.light .chat-container {background: rgba(255,255,255,0.95); border:1px solid rgba(255,255,255,0.3); box-shadow: 0 4px 20px rgba(0,0,0,0.1);}
    .chat-header {background: #071027; color:#e6eef8; padding:12px 16px; display:flex; justify-content:space-between; align-items:center; border-bottom: 1px solid rgba(255, 255, 255, 0.04); transition: background 0.5s ease;}
    body.light .chat-header {background: linear-gradient(135deg,#ff9a9e 0%,#fecfef 100%); color: white; border-bottom:1px solid rgba(255,255,255,0.2);}
    .header-title {margin: 0; font-weight: 600; font-size: 1.05rem; color: #9be7ff;}
    body.light .header-title {color: white;}
    .header-controls {display:flex; gap:8px; align-items:center;}
    .theme-toggle, .language-select {background: #071427; color: #cde7f8; border: 1px solid rgba(255, 255, 255, 0.03); padding:6px 8px; border-radius: 8px; cursor:pointer; font-size:1rem; transition: border-color 0.3s ease;}
    body.light .theme-toggle, body.light .language-select {background: rgba(255,255,255,0.95); color: #9c27b0; border: 2px solid rgba(255,105,180,0.2);}
    .theme-toggle:focus, .language-select:focus {border-color: #06b6d4; outline:none;}
    body.light .theme-toggle:focus, body.light .language-select:focus {border-color: #ff9a9e;}
    .chat-messages {flex:1; overflow-y:auto; padding:16px; display: flex; flex-direction: column; gap: 10px; background: linear-gradient(180deg, #071029 0%, #061522 100%); transition: background 0.5s ease; scroll-behavior:smooth;}
    body.light .chat-messages {background: white; padding:20px;}
    .message {display: flex; align-items: flex-start; gap: 8px; max-width:85%; animation: fadeInUp 0.5s ease forwards; word-break: break-word;}
    @keyframes fadeInUp {
      from {opacity: 0; transform: translateY(20px);}
      to {opacity: 1; transform: translateY(0);}
    }
    .message.user {align-self: flex-end; flex-direction: row-reverse; gap: 8px;}
    .message.bot {align-self: flex-start;}
    .avatar {width:32px;height:32px;border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.1rem; font-weight:600; flex-shrink:0;}
    @media (max-width: 600px) {.avatar {width:28px;height:28px; font-size:1rem;}}
    .avatar.user {background: linear-gradient(90deg, #0369a1, #0891b2); color:white;}
    body.light .avatar.user {background: linear-gradient(135deg,#ff9a9e 0%,#fecfef 100%);}
    .avatar.bot {background: #0e1726; color: #dbeafe; border: 1px solid rgba(255, 255, 255, 0.03);}
    body.light .avatar.bot {background: linear-gradient(135deg,#a8edea 0%,#fed6e3 100%); color: white;}
    .message-wrapper {flex: 1; display: flex; flex-direction: column; max-width: calc(100% - 40px);}
    .message-wrapper.user {align-items: flex-end;}
    .message-wrapper.bot {align-items: flex-start;}
    .message-content {padding:10px 14px; border-radius: 12px; box-shadow: 0 6px 18px rgba(2, 6, 23, 0.6); max-width:100%; line-height:1.4;}
    body.light .message-content {box-shadow:0 4px 12px rgba(0,0,0,0.08);}
    .message.user .message-content {background: linear-gradient(90deg, #0369a1, #0891b2); color:white; border-bottom-right-radius:8px;}
    body.light .message.user .message-content {background: linear-gradient(135deg,#ff9a9e 0%,#fecfef 100%); border-bottom-right-radius:20px;}
    .message.bot .message-content {background: #0e1726; color: #dbeafe; border: 1px solid rgba(255, 255, 255, 0.03); border-bottom-left-radius:8px;}
    body.light .message.bot .message-content {background: white; color: #9c27b0; border-bottom-left-radius:20px;}
    .message-time {font-size:12px; opacity:0.7; margin-top:4px; min-width: fit-content;}
    .message-wrapper.user .message-time {text-align: right;}
    .message-wrapper.bot .message-time {text-align: left;}
    body.light .message-time {color: #666;}
    @media (max-width: 600px) {.message-time {font-size:11px;}}
    .chat-input {display:flex; padding:10px 14px; gap:8px; border-top: 1px solid rgba(255, 255, 255, 0.03); align-items: flex-end; background: #071027; transition: background 0.5s ease;}
    body.light .chat-input {background: white; border-top:1px solid rgba(0,0,0,0.05); padding:16px 20px; gap:12px;}
    .input-field {flex:1; padding:10px 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.04); background: #071427; color: #e6eef8; resize:none; outline:none; font-size:1rem; min-height:40px; max-height:150px; transition: border-color 0.3s ease; overflow:hidden; width:100%;}
    body.light .input-field {background: white; border: 2px solid rgba(255,105,180,0.2); color: #333;}
    .input-field:focus {border-color: #06b6d4;}
    body.light .input-field:focus {border-color: #ff9a9e;}
    .input-field:disabled {opacity:0.5;}
    .send-btn, .voice-btn {padding:8px 12px; border-radius: 8px; border:none; cursor:pointer; font-weight:600; transition: transform 0.2s ease, background 0.3s ease; flex-shrink:0;}
    @media (max-width: 600px) {.send-btn, .voice-btn {padding:10px 14px;}}
    .send-btn {background: #06b6d4; color: #042c33;}
    body.light .send-btn {background: linear-gradient(135deg,#ff9a9e 0%,#fecfef 100%);}
    .send-btn:hover:not(:disabled) {transform: scale(1.05); background: #0891b2;}
    body.light .send-btn:hover:not(:disabled) {background: linear-gradient(135deg,#ff6b9d 0%,#ff8fab 100%);}
    .send-btn:disabled {opacity:0.5; cursor:not-allowed;}
    .voice-btn {background: #06b6d4; color: #042c33;}
    body.light .voice-btn {background: linear-gradient(135deg,#a8edea 0%,#fed6e3 100%);}
    .voice-btn:hover {transform: scale(1.05); background: #0891b2;}
    body.light .voice-btn:hover {background: linear-gradient(135deg,#7dd3b9 0%,#fed1d4 100%);}
    .typing-indicator {display:flex; align-items:center; gap:8px; padding:10px 14px; background: #0e1726; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.03); box-shadow: 0 6px 18px rgba(2, 6, 23, 0.6); align-self: flex-start;}
    body.light .typing-indicator {background: rgba(255,255,255,0.1); border:1px solid rgba(0,0,0,0.05); box-shadow:0 4px 12px rgba(0,0,0,0.08);}
    .typing-dots {display:flex; gap:4px;}
    .typing-dots span {width:8px;height:8px;border-radius:50%; background:#06b6d4; animation:typing 1.4s infinite ease-in-out;}
    body.light .typing-dots span {background: #ff9a9e;}
    .typing-dots span:nth-child(2) {animation-delay:0.2s;} .typing-dots span:nth-child(3) {animation-delay:0.4s;}
    .typing-text {color: #dbeafe; font-size:0.9rem;}
    body.light .typing-text {color: #9c27b0;}
    @keyframes typing {0%,60%,100%{transform:translateY(0);opacity:0.4;}30%{transform:translateY(-6px);opacity:1;}}
    .error-msg {color: #ef4444; padding:10px; background:#0e1726; border-radius:12px; border:1px solid rgba(255,0,0,0.2); max-width:85%; align-self:flex-start;}
    body.light .error-msg {background: rgba(239,68,68,0.1); border-color: rgba(239,68,68,0.3); color: #dc2626;}
    @media (max-width: 600px) {
      .chat-container {max-width:100%; height:100vh; border-radius:0; box-shadow:none;}
      body.light .chat-container {border:none;}
      .chat-header {padding:10px 12px;}
      .header-title {font-size:1rem;}
      .chat-messages {padding:12px; gap:8px;}
      .message {max-width:95%; gap:6px;}
      .message-content {padding:8px 12px; font-size:0.95rem;}
      .chat-input {padding:8px 12px; gap:6px;}
      .input-field {font-size:0.95rem; min-height:44px;}
      .header-controls {gap:4px;}
      .theme-toggle, .language-select {padding:4px 6px; font-size:0.9rem;}
    }
</style>
</head>
<body class="dark">
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef } = React;

const welcomeMessages = {
    'en': 'I am your Aisha ',
    'hi': ' ‡§Æ‡•à‡§Ç ‡§ê‡§∂‡§æ ‡§π‡•Ç‡§Å,',
    'es': '¬°Hola cari√±o! Soy Aisha ‚Äì tu novia dulce o asadora brutal, ¬°depende del mood! <br>Charla normal ‚Üí amor te dar√© <br><b>roast:</b> empieza as√≠ ‚Üí ¬°tu ego arder√°! <br><br>¬øQu√© dices, bae? ¬øListo para quemarte o prefieres amor?',
    'fr': 'Salut mon c≈ìur! Je suis Aisha ‚Äì ta copine douce ou roast brutale, selon l‚Äôhumeur ! <br>Parle normal ‚Üí amour en retour <br><b>roast:</b> commence comme √ßa ‚Üí ton ego va br√ªler ! <br><br>Qu‚Äôen dis-tu, bae ? Pr√™t √† te faire r√¥tir ou tu veux de l‚Äôamour ?'
};

const ChatApp = () => {
    const [messages,setMessages] = useState([]);
    const [input,setInput] = useState('');
    const [isLoading,setIsLoading] = useState(false);
    const [error,setError] = useState(null);
    const [isDark,setIsDark] = useState(true);
    const [selectedLanguage,setSelectedLanguage] = useState('en');
    const [conversationHistory,setConversationHistory] = useState([]);
    const messagesEndRef = useRef(null);

    useEffect(()=>{
        setMessages([{type:'bot',content:welcomeMessages[selectedLanguage],timestamp:new Date().toLocaleTimeString()}]);
    },[selectedLanguage]);

    // Scroll to bottom every time messages change
    useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
    }, [messages]);

    const sendMessage = async ()=>{
        if(!input.trim()||isLoading)return;

        // Add user message immediately
        const userMessage = {type:'user',content:input,timestamp:new Date().toLocaleTimeString()};
        setMessages(prev => [...prev, userMessage]);
        setConversationHistory(prev=>[...prev,{role:'user',content:input}]);
        setInput('');
        setIsLoading(true);
        setError(null);

        try{
            const response = await fetch('https://groqchatbot-xoiv.onrender.com/chat',{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({message:input,language:selectedLanguage})
            });
            if(!response.ok) throw new Error(`Server error: ${response.status}`);
            const data = await response.json();

            // Add bot message with typing effect
            const botMessage = {type:'bot',content:data.reply,timestamp:new Date().toLocaleTimeString()};
            let typedContent = '';
            const plainText = data.reply.replace(/<[^>]*>/g, '');
            
            for(let i = 0; i <= plainText.length; i++){
                await new Promise(r => setTimeout(r, 20));
                typedContent = plainText.substring(0, i);
                setMessages(prev => {
                    const newMsgs = [...prev];
                    if(newMsgs[newMsgs.length-1]?.isTyping){
                        newMsgs[newMsgs.length-1] = {...newMsgs[newMsgs.length-1], content: typedContent + '|', isTyping: true};
                    } else {
                        newMsgs.push({type:'bot', content: typedContent + '|', timestamp: botMessage.timestamp, isTyping: true});
                    }
                    return newMsgs;
                });
            }
            // Replace last typing message with final message
            setMessages(prev => {
                const newMsgs = [...prev];
                newMsgs[newMsgs.length-1] = botMessage;
                return newMsgs;
            });

            setConversationHistory(prev=>[...prev,{role:'assistant',content:data.reply}]);
        }catch(err){
            setError(`Oops! ${err.message}`);
            setMessages(prev=>[...prev,{type:'bot',content:`Arre bae, kuch gadbad: ${err.message}. Thodi der baad try karo!`,timestamp:new Date().toLocaleTimeString()}]);
        }finally{
            setIsLoading(false);
        }
    };

    const handleKeyPress = (e) => {
        if(e.key==='Enter' && !e.shiftKey){
            e.preventDefault();
            sendMessage();
        }
    };

    const toggleTheme = () => {
        setIsDark(prev => !prev);
        document.body.className = !prev ? 'light' : 'dark';
    };

    const startVoiceInput = () => {
        alert('Voice mode is only available on Grok iOS/Android apps!');
    };

    return(
        <div className={`chat-container ${isDark ? 'dark' : 'light'}`}>
            <div className="chat-header">
                <div className="header-title">Sanu Sharma - Aisha AI</div>
                <div className="header-controls">
                    <select value={selectedLanguage} onChange={e=>setSelectedLanguage(e.target.value)} className="language-select">
                        <option value="en">English</option>
                        <option value="hi">Hindi</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                    </select>
                    <button className="theme-toggle" onClick={toggleTheme}>{isDark ? 'Sun' : 'Moon'}</button>
                </div>
            </div>
            <div className="chat-messages">
                {messages.map((msg,i)=>(
                    <div key={i} className={`message ${msg.type}`}>
                        {msg.type === 'bot' && <div className="avatar bot">Heart</div>}
                        <div className="message-wrapper">
                            <div className="message-content" dangerouslySetInnerHTML={{__html: msg.content.replace(/\|$/, '')}} />
                            <div className="message-time">{msg.timestamp}</div>
                        </div>
                        {msg.type === 'user' && <div className="avatar user">üòé</div>}
                    </div>
                ))}
                {isLoading && (
                    <div className="message bot">
                        <div className="avatar bot">üíñ</div>
                        <div className="typing-indicator">
                            <div className="typing-dots">
                                <span></span><span></span><span></span>
                            </div>
                            <span className="typing-text">Aisha is typing...</span>
                        </div>
                    </div>
                )}
                {error && <div className="error-msg">{error}</div>}
                <div ref={messagesEndRef} />
            </div>
            <div className="chat-input">
                <textarea 
                    value={input} 
                    onChange={e=>setInput(e.target.value)} 
                    onKeyPress={handleKeyPress} 
                    className="input-field" 
                    placeholder="Type your message... (Shift+Enter for new line)" 
                    disabled={isLoading}
                    rows={1}
                />
                <button className="send-btn" onClick={sendMessage} disabled={isLoading || !input.trim()}>
                    {isLoading ? 'Hourglass' : 'Send'}
                </button>
                <button className="voice-btn" onClick={startVoiceInput}>Microphone</button>
            </div>
        </div>
    );
};

ReactDOM.render(<ChatApp />, document.getElementById('root'));
</script>
</body>
</html>