<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Sanu Sharma - TattvionAI (v2)</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ---------- base ---------- */
      :root {
        --glass: rgba(255, 255, 255, 0.75);
        --glass-2: rgba(255, 255, 255, 0.65);
        --muted: #6b7280;
        --accent-from: #667eea;
        --accent-to: #764ba2;
        --accent-2-from: #f093fb;
        --accent-2-to: #f5576c;
        --success: #10b981;
        --danger: #ef4444;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body,
      #root {
        height: 100%;
      }
      body {
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", Roboto, "Helvetica Neue", Arial;
        background: linear-gradient(135deg, #eef2ff 0%, #e2e8f0 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
        transition: background 0.3s ease;
      }
      body.dark {
        background: linear-gradient(135deg, #0f172a 0%, #1f2937 100%);
      }

      /* ---------- container ---------- */
      .app {
        width: 100%;
        max-width: 980px;
        height: 88vh;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.85),
          rgba(255, 255, 255, 0.72)
        );
        backdrop-filter: blur(8px);
        border-radius: 18px;
        box-shadow: 0 20px 50px rgba(15, 23, 42, 0.12);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        border: 1px solid rgba(255, 255, 255, 0.6);
      }
      body.dark .app {
        background: linear-gradient(
          180deg,
          rgba(8, 10, 14, 0.6),
          rgba(8, 10, 14, 0.5)
        );
        border: 1px solid rgba(255, 255, 255, 0.06);
      }

      /* ---------- header ---------- */
      .top {
        padding: 18px 24px;
        display: flex;
        align-items: center;
        gap: 12px;
        background: linear-gradient(
          90deg,
          var(--accent-from),
          var(--accent-to)
        );
        color: white;
      }
      .brand {
        font-weight: 700;
        font-size: 1.2rem;
        flex: 1;
      }
      .controls {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .select,
      .btn {
        border-radius: 12px;
        padding: 8px 12px;
        border: none;
        font-size: 0.95rem;
      }
      .select {
        background: rgba(255, 255, 255, 0.18);
        color: white;
      }
      .btn {
        cursor: pointer;
        background: rgba(255, 255, 255, 0.12);
        color: white;
      }
      .btn:hover {
        transform: translateY(-2px);
      }

      /* ---------- messages area ---------- */
      .messages {
        flex: 1;
        overflow: auto;
        padding: 22px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        background: linear-gradient(to bottom, var(--glass), transparent);
      }
      body.dark .messages {
        background: linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.02),
          transparent
        );
      }

      .msg-row {
        display: flex;
        align-items: flex-end;
        gap: 12px;
        max-width: 100%;
      }
      .msg-row.bot {
        justify-content: flex-start;
      }
      .msg-row.user {
        justify-content: flex-end;
      }

      .avatar {
        width: 44px;
        height: 44px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        flex-shrink: 0;
        box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
      }
      .avatar.bot {
        background: linear-gradient(
          135deg,
          var(--accent-2-from),
          var(--accent-2-to)
        );
        color: white;
      }
      .avatar.user {
        background: linear-gradient(
          135deg,
          var(--accent-from),
          var(--accent-to)
        );
        color: white;
      }
      body.dark .avatar {
        box-shadow: 0 8px 24px rgba(2, 6, 23, 0.6);
      }

      .bubble {
        padding: 14px 16px;
        border-radius: 14px;
        max-width: 76%;
        position: relative;
        font-size: 0.98rem;
        line-height: 1.5;
        box-shadow: 0 10px 30px rgba(2, 6, 23, 0.06);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .bubble.bot {
        background: rgba(255, 255, 255, 0.95);
        color: #0f172a;
        border-bottom-left-radius: 6px;
      }
      .bubble.user {
        background: linear-gradient(
          135deg,
          var(--accent-from),
          var(--accent-to)
        );
        color: white;
        border-bottom-right-radius: 6px;
      }
      body.dark .bubble.bot {
        background: rgba(255, 255, 255, 0.04);
        color: rgba(255, 255, 255, 0.95);
      }

      .meta {
        font-size: 0.78rem;
        color: var(--muted);
        margin-top: 8px;
        text-align: right;
      }
      body.dark .meta {
        color: #9ca3af;
      }

      /* Nice pop animation */
      .bubble.enter {
        animation: popIn 0.36s cubic-bezier(0.2, 0.9, 0.3, 1);
      }
      @keyframes popIn {
        0% {
          transform: translateY(8px) scale(0.98);
          opacity: 0;
        }
        100% {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
      }

      /* typing placeholder */
      .typing {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--accent-from),
          var(--accent-to)
        );
        opacity: 0.9;
        animation: typingAnim 1.2s infinite;
      }
      .dot:nth-child(2) {
        animation-delay: 0.12s;
      }
      .dot:nth-child(3) {
        animation-delay: 0.24s;
      }
      @keyframes typingAnim {
        0% {
          transform: translateY(0);
          opacity: 0.3;
        }
        30% {
          transform: translateY(-6px);
          opacity: 1;
        }
        60% {
          transform: translateY(0);
          opacity: 0.45;
        }
        100% {
          transform: translateY(0);
          opacity: 0.3;
        }
      }

      /* ---------- input ---------- */
      .composer {
        display: flex;
        gap: 10px;
        padding: 16px;
        border-top: 1px solid rgba(2, 6, 23, 0.04);
        align-items: center;
      }
      body.dark .composer {
        border-top: 1px solid rgba(255, 255, 255, 0.04);
      }
      .input {
        flex: 1;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid rgba(2, 6, 23, 0.06);
        min-height: 46px;
        resize: none;
        outline: none;
        font-size: 0.96rem;
        background: rgba(255, 255, 255, 0.92);
      }
      body.dark .input {
        background: rgba(255, 255, 255, 0.02);
        color: inherit;
        border: 1px solid rgba(255, 255, 255, 0.04);
      }
      .send {
        padding: 10px 14px;
        border-radius: 12px;
        border: none;
        background: linear-gradient(
          135deg,
          var(--accent-from),
          var(--accent-to)
        );
        color: white;
        font-weight: 600;
        cursor: pointer;
      }
      .send:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      /* small utilities */
      .small {
        font-size: 0.82rem;
        color: var(--muted);
      }
      .top-actions {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      /* responsive */
      @media (max-width: 720px) {
        .app {
          height: 100vh;
          border-radius: 0;
        }
        .avatar {
          width: 40px;
          height: 40px;
        }
        .bubble {
          max-width: 82%;
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useState, useRef } = React;

      const WELCOMES = {
        en: {
          default:
            "Hello! I'm Tattvion ‚Äî your versatile assistant. How can I help?",
          professional:
            "Greetings. I'm Tattvion, your consultant. How may I assist you?",
          gf: "Hey cutie! üíï I'm Tattvion ‚Äî what's the vibe today?",
          casual: "Yo! Tattvion here. What's poppin'?",
          creative: "Once upon a chat... Ready to create magic? ‚ú®",
        },
        hi: {
          default: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç Tattvion ‡§π‡•Ç‡§Å ‚Äî ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡•Ç‡§Å?",
          professional:
            "‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞‡•§ ‡§Æ‡•à‡§Ç Tattvion ‡§π‡•Ç‡§Å ‚Äî ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ/‡§∏‡§ï‡§§‡•Ä ‡§π‡•Ç‡§Å?",
          gf: "‡§π‡§æ‡§Ø ‡§ï‡•ç‡§Ø‡•Ç‡§ü‡•Ä! üíï ‡§ï‡•ç‡§Ø‡§æ ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à?",
          casual: "‡§Ø‡•ã! Tattvion ‡§Ø‡§π‡§æ‡§Å ‚Äî ‡§¨‡§§‡§æ‡§ì ‡§ï‡•ç‡§Ø‡§æ ‡§ö‡§æ‡§π‡§ø‡§è?",
          creative: "‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§ï‡•Ä ‡§¨‡§æ‡§§ ‡§π‡•à... ‡§ö‡§≤‡•ã ‡§ï‡•Å‡§õ ‡§ï‡•ç‡§∞‡§ø‡§è‡§ü‡§ø‡§µ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç!",
        },
        es: {
          default:
            "¬°Hola! Soy Tattvion ‚Äî tu asistente vers√°til. ¬øEn qu√© puedo ayudarte?",
          professional:
            "Saludos. Soy Tattvion, tu consultor. ¬øEn qu√© puedo asistirte?",
          gf: "¬°Hola guapo/a! üíï Soy Tattvion ‚Äî ¬øqu√© tal hoy?",
          casual: "¬°Ey! Tattvion aqu√≠. ¬øQu√© pasa?",
          creative: "√ârase una vez en el chat... ¬øListo para crear magia? ‚ú®",
        },
        fr: {
          default:
            "Bonjour ! Je suis Tattvion ‚Äî votre assistant polyvalent. Comment puis-je vous aider ?",
          professional:
            "Bonjour. Je suis Tattvion, votre consultant. En quoi puis-je vous assister ?",
          gf: "Salut mon c≈ìur ! üíï Je suis Tattvion ‚Äî quelle est l'ambiance aujourd'hui ?",
          casual: "Yo ! Tattvion ici. Qu'est-ce qui se passe ?",
          creative:
            "Il √©tait une fois dans un chat... Pr√™t √† cr√©er de la magie ? ‚ú®",
        },
      };

      function nowTime() {
        return new Date().toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      function uniqueId(prefix = "m") {
        return (
          prefix +
          Date.now().toString(36) +
          Math.random().toString(36).slice(2, 7)
        );
      }

      function ChatApp() {
        const [lang, setLang] = useState("en");
        const [mode, setMode] = useState("default");
        const [messages, setMessages] = useState([]);
        const [text, setText] = useState("");
        const [loading, setLoading] = useState(false);
        const [dark, setDark] = useState(false);
        const [typingSpeed, setTypingSpeed] = useState(15); 
        const messagesRef = useRef(null);
        const abortRef = useRef(null);

        useEffect(() => {
          if (messages.length === 0) {
            const w = WELCOMES[lang]?.[mode] || WELCOMES["en"].default;
            setMessages([
              {
                id: uniqueId("bot"),
                type: "bot",
                content: w,
                timestamp: nowTime(),
              },
            ]);
          }
        }, [messages.length, lang, mode]);

        useEffect(() => {
          document.body.classList.toggle("dark", dark);
        }, [dark]);

        useEffect(() => {
          // keep scroll at bottom
          const el = messagesRef.current;
          if (!el) return;
          el.scrollTop = el.scrollHeight;
        }, [messages]);

        const appendMessage = (msg) => setMessages((prev) => [...prev, msg]);

        async function send() {
          if (!text.trim() || loading) return;
          const userMsg = {
            id: uniqueId("u"),
            type: "user",
            content: text.trim(),
            timestamp: nowTime(),
          };
          appendMessage(userMsg);
          setText("");
          setLoading(true);
          setMessages((prev) => [
            ...prev,
            {
              id: uniqueId("bot-p"),
              type: "bot",
              content: "",
              timestamp: nowTime(),
              placeholder: true,
            },
          ]);

          try {
            // abort controller in case we extend
            abortRef.current?.abort?.();
            const controller = new AbortController();
            abortRef.current = controller;

            const res = await fetch(
              "https://groqchatbot-xoiv.onrender.com/chat",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  message: userMsg.content,
                  language: lang,
                  mode,
                }),
                signal: controller.signal,
              }
            );

            if (!res.ok) throw new Error("Server returned " + res.status);
            const data = await res.json();
            const reply = data.reply ?? "Sorry, I had no reply.";

            // typewriter: update last message in place (fixed: removed unused lastIndex calculation)
            let typed = "";
            for (let i = 0; i < reply.length; i++) {
              typed += reply[i];
              setMessages((prev) => {
                const copy = [...prev];
                const idx = copy.length - 1;
                copy[idx] = {
                  ...copy[idx],
                  content: typed + (i < reply.length - 1 ? "|" : ""),
                  timestamp: nowTime(),
                  placeholder: true,
                };
                return copy;
              });
              await new Promise((r) => setTimeout(r, typingSpeed));
            }

            // remove placeholder flag and finalize (timestamp updated only once at end for efficiency)
            setMessages((prev) => {
              const copy = [...prev];
              const idx = copy.length - 1;
              copy[idx] = {
                ...copy[idx],
                content: typed,
                timestamp: nowTime(),
                placeholder: false,
              };
              return copy;
            });
          } catch (err) {
            console.error(err);
            setMessages((prev) => {
              const copy = [...prev];
              const idx = copy.length - 1;
              copy[idx] = {
                ...copy[idx],
                content: `Error: ${err.message}`,
                timestamp: nowTime(),
                placeholder: false,
              };
              return copy;
            });
          } finally {
            setLoading(false);
            abortRef.current = null;
          }
        }

        function onKey(e) {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            send();
          }
        }

        function clearChat() {
          setMessages([]);
        }

        return (
          <div className="app" role="application">
            <div className="top">
              <div className="brand">Sanu Sharma ‚Äî TattvionAI</div>
              <div className="top-actions controls">
                <select
                  className="select"
                  value={lang}
                  onChange={(e) => setLang(e.target.value)}
                  aria-label="language"
                >
                  <option value="en">English</option>
                  <option value="hi">Hindi</option>
                  <option value="es">Spanish</option>
                  <option value="fr">French</option>
                </select>

                <select
                  className="select"
                  value={mode}
                  onChange={(e) => setMode(e.target.value)}
                  aria-label="mode"
                >
                  <option value="default">Default</option>
                  <option value="professional">Professional</option>
                  <option value="gf">GF Mode üíï</option>
                  <option value="casual">Casual</option>
                  <option value="creative">Creative ‚ú®</option>
                </select>

                <button
                  className="btn"
                  onClick={() => setDark((d) => !d)}
                  aria-pressed={dark}
                >
                  {dark ? "‚òÄÔ∏è" : "üåô"}
                </button>

                <button className="btn" onClick={clearChat}>
                  Clear
                </button>
              </div>
            </div>

            <div className="messages" ref={messagesRef} aria-live="polite">
              {messages.map((m) => (
                <div key={m.id} className={`msg-row ${m.type}`}>
                  {m.type === "bot" && (
                    <div className="avatar bot" aria-hidden="true">
                      ü§ñ
                    </div>
                  )}
                  {m.type === "user" && (
                    <div className="avatar user" aria-hidden="true">
                      üë§
                    </div>
                  )}

                  <div className={`bubble enter ${m.type}`}>
                    {m.placeholder ? (
                      <div className="typing" aria-hidden="true">
                        <div className="dot"></div>
                        <div className="dot"></div>
                        <div className="dot"></div>
                        <div style={{ marginLeft: 8 }} className="small">
                          Tattvion is typing...
                        </div>
                      </div>
                    ) : (
                      <div style={{ whiteSpace: "pre-wrap" }}>{m.content}</div>
                    )}

                    <div className="meta">{m.timestamp}</div>
                  </div>

                  {/* user's avatar on right for user messages */}
                </div>
              ))}
            </div>

            <div className="composer">
              <textarea
                className="input"
                placeholder={`Type a message ‚Äî Lang: ${lang.toUpperCase()} | Mode: ${mode}`}
                value={text}
                onChange={(e) => setText(e.target.value)}
                onKeyDown={onKey}
                rows={1}
                disabled={loading}
                aria-label="Message input"
              />
              <button
                className="send"
                onClick={send}
                disabled={loading || !text.trim()}
                aria-label="Send"
              >
                {loading ? "Sending‚Ä¶" : "Send"}
              </button>
            </div>
          </div>
        );
      }

      ReactDOM.render(<ChatApp />, document.getElementById("root"));
    </script>
  </body>
</html>
